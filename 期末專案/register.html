<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>客戶註冊</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #eff6ff;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 420px;
      margin: 60px auto;
      background: #ffffff;
      border-radius: 16px;
      padding: 24px 28px 28px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.15);
    }
    h1 {
      margin: 0 0 12px;
      font-size: 22px;
      color: #111827;
      text-align: center;
    }
    p.desc {
      margin: 0 0 20px;
      font-size: 13px;
      color: #6b7280;
      text-align: center;
    }
    label {
      display: block;
      font-size: 14px;
      color: #374151;
      margin-bottom: 6px;
    }
    input, select {
      width: 100%;
      padding: 9px 10px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      margin-bottom: 14px;
      box-sizing: border-box;
    }
    .btn-row {
      margin-top: 12px;
      display: flex;
      gap: 10px;
      justify-content: space-between;
    }
    .btn {
      flex: 1;
      padding: 10px 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      white-space: nowrap;
    }
    .btn-primary {
      background: #2563eb;
      color: #fff;
    }
    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }
    .hint {
      margin-top: 8px;
      font-size: 12px;
      color: #9ca3af;
      text-align: center;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>客戶註冊</h1>
    <p class="desc">建立新客戶帳號,之後可用此帳號登入系統寄送與查詢包裹。</p>

    <label for="username">帳號(必填)</label>
    <input id="username" placeholder="例如:test1">

    <label for="password">密碼(必填)</label>
    <input id="password" type="password" placeholder="請輸入密碼">

    <label for="confirm">確認密碼</label>
    <input id="confirm" type="password" placeholder="再次輸入密碼">

    <label for="name">姓名</label>
    <input id="name" placeholder="例:王小明">

    <label for="phone">電話</label>
    <input id="phone" placeholder="例:0912-345678">

    <label for="email">Email</label>
    <input id="email" placeholder="例:user@example.com">

    <label for="address">地址</label>
    <input id="address" placeholder="例:高雄市燕巢區...">

    <!-- ✅ 新增客戶類型 -->
    <label for="customerType">客戶類型</label>
    <select id="customerType">
      <option value="NON_CONTRACT">非合約客戶（以現金或信用卡支付）</option>
      <option value="CONTRACT">合約客戶（設有月結帳戶）</option>
      <option value="PREPAID">預付客戶（貨運費用由商家或第三方支付）</option>
    </select>

    <!-- ✅ 新增帳單偏好 -->
    <label for="billingPreference">帳單偏好</label>
    <select id="billingPreference">
      <option value="COD">貨到付款(預設)</option>
      <option value="MONTHLY">月結帳單</option>
      <option value="PREPAID">預付款項</option>
    </select>

    <div class="btn-row">
      <button class="btn btn-secondary" type="button" onclick="goLogin()">回登入</button>
      <button class="btn btn-primary" type="button" onclick="doRegister()">註冊</button>
    </div>

  </div>

  <script>
    const API_BASE = "http://127.0.0.1:5000";

    function goLogin() {
      window.location.href = "login.html";
    }

    async function doRegister() {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value;
      const confirm = document.getElementById("confirm").value;
      const name = document.getElementById("name").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const email = document.getElementById("email").value.trim();
      const address = document.getElementById("address").value.trim();
      const customerType = document.getElementById("customerType").value;      // ✅
      const billingPreference = document.getElementById("billingPreference").value;  // ✅

      if (!username || !password) {
        alert("請填寫帳號與密碼");
        return;
      }
      if (password !== confirm) {
        alert("兩次輸入的密碼不一致");
        return;
      }

      const payload = {
        username,
        password,
        name,
        phone,
        email,
        address,
        customer_type: customerType,          // ✅
        billing_preference: billingPreference  // ✅
      };

      try {
        const res = await fetch(`${API_BASE}/api/auth/register`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        const result = await res.json();

        if (!res.ok) {
          alert("註冊失敗:" + (result.error || res.status));
          return;
        }

        alert("註冊成功!請使用此帳號登入系統。");
        window.location.href = "login.html";
      } catch (err) {
        console.error(err);
        alert("註冊過程發生錯誤");
      }
    }
  </script>
</body>
</html>